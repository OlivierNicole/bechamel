<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mperf (mperf.Mperf)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0-359-g492257c"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">mperf</a> &#x00BB; Mperf</nav><header><h1>Module <code>Mperf</code></h1></header><div class="content"><div class="spec module" id="module-Attr" class="anchored"><a href="#module-Attr" class="anchor"></a><code><span class="keyword">module</span> <a href="Attr/index.html">Attr</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-KindMap" class="anchored"><a href="#module-KindMap" class="anchor"></a><code><span class="keyword">module</span> KindMap : <span class="xref-unresolved">Stdlib</span>.Map.S <span class="keyword">with</span> <span class="keyword">type</span> <a href="index.html#module-KindMap">KindMap</a>.key = <span class="xref-unresolved">Attr</span>.Kind.t</code></div><div class="spec type" id="type-flag" class="anchored"><a href="#type-flag" class="anchor"></a><code><span class="keyword">type</span> flag = </code><table><tr id="type-flag.Fd_cloexec" class="anchored"><td class="def variant constructor"><a href="#type-flag.Fd_cloexec" class="anchor"></a><code>| <span class="constructor">Fd_cloexec</span></code></td><td class="doc"><p>(since Linux 3.14). This flag enables the close-on-exec flag for the created event file descriptor, so that the file descriptor is automatically closed on execve(2). Setting the close-on-exec flags at creation time, rather than later with fcntl(2), avoids potential race conditions where the calling thread invokes perf_event_open() and fcntl(2) at the same time as another thread calls fork(2) then execve(2).</p></td></tr><tr id="type-flag.Fd_no_group" class="anchored"><td class="def variant constructor"><a href="#type-flag.Fd_no_group" class="anchor"></a><code>| <span class="constructor">Fd_no_group</span></code></td><td class="doc"><p>This flag allows creating an event as part of an event group but having no group leader. It is unclear why this is useful.</p></td></tr><tr id="type-flag.Fd_output" class="anchored"><td class="def variant constructor"><a href="#type-flag.Fd_output" class="anchor"></a><code>| <span class="constructor">Fd_output</span></code></td><td class="doc"><p>This flag reroutes the output from an event to the group leader.</p></td></tr><tr id="type-flag.Pid_cgroup" class="anchored"><td class="def variant constructor"><a href="#type-flag.Pid_cgroup" class="anchor"></a><code>| <span class="constructor">Pid_cgroup</span></code></td><td class="doc"><p>This flag activates per-container system-wide monitoring. A container is an abstraction that isolates a set of resources for finer-grained control (CPUs, memory, etc.). In this mode, the event is measured only if the thread running on the monitored CPU belongs to the designated container (cgroup). The cgroup is identified by passing a file descriptor opened on its directory in the cgroupfs filesystem. For instance, if the cgroup to monitor is called test, then a file descriptor opened on /dev/cgroup/test (assuming cgroupfs is mounted on /dev/cgroup) must be passed as the pid parameter. cgroup monitoring is available only for system-wide events and may therefore require extra permissions.</p></td></tr></table></div><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><p>Opaque type of an event counter (internally <code>t</code> is a file descriptor). Each file descriptor corresponds to one event that is measured; these can be grouped together to measure multiple events simultaneously.</p></div></div><div><div class="spec value" id="val-make" class="anchored"><a href="#val-make" class="anchor"></a><code><span class="keyword">val</span> make : <span>?&#8288;pid:int</span> <span>&#45;&gt;</span> <span>?&#8288;cpu:int</span> <span>&#45;&gt;</span> <span>?&#8288;group:<a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>?&#8288;flags:<span><a href="index.html#type-flag">flag</a> list</span></span> <span>&#45;&gt;</span> <a href="Attr/index.html#type-t">Attr.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>make ~pid ~cpu ?group ?flags attr</code> is a perf event counter. Refer to perf_event_open(2) for the description of the arguments. One counter only counts one kind of attribute at a time. If you want to simultanously count different metrics (like the perf stat tool does), you have to setup several counters.</p></div></div><div><div class="spec value" id="val-kind" class="anchored"><a href="#val-kind" class="anchor"></a><code><span class="keyword">val</span> kind : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Attr/Kind/index.html#type-t">Attr.Kind.t</a></code></div><div><p><code>kind c</code> is the kind of events that this counter counts.</p></div></div><div><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int64</code></div><div><p><code>read c</code> is the value of the counter <code>c</code>.</p></div></div><div><div class="spec value" id="val-reset" class="anchored"><a href="#val-reset" class="anchor"></a><code><span class="keyword">val</span> reset : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>reset c</code> sets <code>c</code> to zero.</p></div></div><div><div class="spec value" id="val-enable" class="anchored"><a href="#val-enable" class="anchor"></a><code><span class="keyword">val</span> enable : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p>Start measuring.</p></div></div><div><div class="spec value" id="val-disable" class="anchored"><a href="#val-disable" class="anchor"></a><code><span class="keyword">val</span> disable : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p>Disabling an event. When an event is disabled it does not count or generate overflows but does continue to exist and maintain its count value.</p></div></div><div><div class="spec value" id="val-close" class="anchored"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p>Free resources associated with a counter.</p></div></div><div><div class="spec type" id="type-execution" class="anchored"><a href="#type-execution" class="anchor"></a><code><span class="keyword">type</span> execution = <span class="keyword">private</span> {</code><table><tr id="type-execution.process_status" class="anchored"><td class="def record field"><a href="#type-execution.process_status" class="anchor"></a><code>process_status : <span class="xref-unresolved">Unix</span>.process_status;</code></td></tr><tr id="type-execution.stdout" class="anchored"><td class="def record field"><a href="#type-execution.stdout" class="anchor"></a><code>stdout : string;</code></td></tr><tr id="type-execution.stderr" class="anchored"><td class="def record field"><a href="#type-execution.stderr" class="anchor"></a><code>stderr : string;</code></td></tr><tr id="type-execution.data" class="anchored"><td class="def record field"><a href="#type-execution.data" class="anchor"></a><code>data : <span><span class="xref-unresolved">Stdlib</span>.Int64.t <span class="xref-unresolved">KindMap</span>.t</span>;</code></td></tr></table><code>}</code></div><div><p>Type returned by <code>with_process</code></p></div></div><div><div class="spec value" id="val-with_process" class="anchored"><a href="#val-with_process" class="anchor"></a><code><span class="keyword">val</span> with_process : <span>?&#8288;env:<span>string list</span></span> <span>&#45;&gt;</span> <span>?&#8288;timeout:int</span> <span>&#45;&gt;</span> <span>?&#8288;stdout:string</span> <span>&#45;&gt;</span> <span>?&#8288;stderr:string</span> <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> <span><a href="Attr/index.html#type-t">Attr.t</a> list</span> <span>&#45;&gt;</span> <span>[ <span>`Ok of <a href="index.html#type-execution">execution</a></span> <span>| `Timeout</span> <span><span>| `Exn</span> of exn</span> ]</span></code></div><div><p><code>with_process ?env ?timeout ?stdout ?stderr cmd attrs</code> is the result of the execution of the program described by <code>cmd</code>. This can either be a successful execution, or an error.</p></div></div><div><div class="spec value" id="val-enable_all" class="anchored"><a href="#val-enable_all" class="anchor"></a><code><span class="keyword">val</span> enable_all : unit <span>&#45;&gt;</span> unit</code></div><div><p>A process can enable or disable all the event groups that are attached to it using the prctl(2) PR_TASK_PERF_EVENTS_ENABLE and PR_TASK_PERF_EVENTS_DISABLE operations. This applies to all counters on the calling process, whether created by this process or by another, and does not affect any counters that this process has created on other processes. It enables or disables only the group leaders, not any other members in the groups.</p></div></div><div class="spec value" id="val-disable_all" class="anchored"><a href="#val-disable_all" class="anchor"></a><code><span class="keyword">val</span> disable_all : unit <span>&#45;&gt;</span> unit</code></div></div></body></html>